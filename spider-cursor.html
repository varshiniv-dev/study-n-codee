<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Spider Cursor Effect</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            overflow: hidden;
            background: #000;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        let width = 0;
        let height = 0;

        const { sin, cos, PI, hypot } = Math;

        // ---------- utils ----------
        function rand(range = 1, offset = 0) {
            return Math.random() * range + offset;
        }

        function lerp(a, b, t) {
            return a + (b - a) * t;
        }

        function makePoint(x, y) {
            return { x, y };
        }

        function mapArray(count, fn) {
            const arr = new Array(count);
            for (let i = 0; i < count; i++) arr[i] = fn(i);
            return arr;
        }

        // noisy function to wobble the lines
        function noise2D(x, y, t) {
            const w0 =
                sin(0.32 * x + 1.41 * t + 2.03 +
                    2.51 * sin(0.37 * y - 1.27 * t + 0.91));
            const w1 =
                sin(0.21 * y + 1.59 * t + 2.77 +
                    2.29 * sin(0.49 * x - 1.17 * t + 0.63));
            return w0 + w1;
        }

        function drawFilledCircle(x, y, r) {
            ctx.beginPath();
            ctx.ellipse(x, y, r, r, 0, 0, PI * 2);
            ctx.fill();
        }

        function drawWigglyLine(x0, y0, x1, y1, t) {
            ctx.beginPath();
            ctx.moveTo(x0, y0);
            const steps = 100;
            for (let i = 1; i <= steps; i++) {
                const k = i / steps;
                let x = lerp(x0, x1, k);
                let y = lerp(y0, y1, k);
                const n = noise2D(x * 0.2 + x0 * 0.05, y * 0.2 + y0 * 0.05, t) * 2;
                ctx.lineTo(x + n, y + n);
            }
            ctx.stroke();
        }

        // ---------- spider factory ----------
        function createSpider() {
            // random background "stars"
            const nodes = mapArray(330, () => ({
                x: rand(window.innerWidth),
                y: rand(window.innerHeight),
                amount: 0,
                radius: 0
            }));

            // 9 points around a circle (legs around body)
            const spokes = mapArray(9, (i) => {
                const angle = (i / 9) * PI * 2;
                return { x: cos(angle), y: sin(angle) };
            });

            const phase = rand(100);

            let targetX = rand(window.innerWidth);
            let targetY = rand(window.innerHeight);

            let x = rand(window.innerWidth);
            let y = rand(window.innerHeight);

            const freqX = rand(0.5, 0.5); // ~0.5â€“1.0
            const freqY = rand(0.5, 0.5);
            const wander = makePoint(rand(50, 50), rand(50, 50));

            function baseRadius() {
                return window.innerWidth / rand(100, 150);
            }

            let bodyRadius = baseRadius();

            function drawNode(node, time) {
                const len = node.amount;
                if (len <= 0) return;

                const eased = len * len;

                // draw noisy lines from body to this node using spokes
                for (const spoke of spokes) {
                    const sx = x + spoke.x * bodyRadius;
                    const sy = y + spoke.y * bodyRadius;

                    const px = lerp(sx, node.x, eased);
                    const py = lerp(sy, node.y, eased);

                    drawWigglyLine(px, py, sx, sy, time);
                }

                // bright point at node
                drawFilledCircle(node.x, node.y, node.radius);
            }

            return {
                setTarget(px, py) {
                    targetX = px;
                    targetY = py;
                },

                update(time) {
                    // spider does a small orbit around cursor
                    const wanderX = cos(time * freqX + phase) * wander.x;
                    const wanderY = sin(time * freqY + phase) * wander.y;

                    const fx = targetX + wanderX;
                    const fy = targetY + wanderY;

                    const maxStep = window.innerWidth / 100;
                    x += Math.max(-maxStep, Math.min(maxStep, (fx - x) / 10));
                    y += Math.max(-maxStep, Math.min(maxStep, (fy - y) / 10));

                    bodyRadius = baseRadius();

                    let activated = 0;

                    for (let i = 0; i < nodes.length; i++) {
                        const node = nodes[i];
                        const dx = node.x - x;
                        const dy = node.y - y;
                        const dist = hypot(dx, dy) || 1;

                        let r = Math.min(2.2, window.innerWidth / (dist * 5));

                        const close = dist < window.innerWidth / 10 && activated < 8;
                        let delta = close ? 0.12 : -0.1;

                        if (close) {
                            r *= 1.6;
                            activated++;
                        }

                        node.radius = r;
                        node.amount = Math.max(0, Math.min(node.amount + delta, 1));

                        drawNode(node, time);
                    }
                }
            };
        }

        // ---------- setup ----------
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        window.addEventListener("resize", resize);
        resize();

        const spiders = [createSpider(), createSpider()];

        window.addEventListener("pointermove", (event) => {
            const { clientX, clientY } = event;
            spiders.forEach((spider) => spider.setTarget(clientX, clientY));
        });

        // ---------- animation loop ----------
        function loop(timestamp) {
            if (width !== window.innerWidth || height !== window.innerHeight) {
                resize();
            }

            // background
            ctx.fillStyle = "#000";
            drawFilledCircle(0, 0, width * 10);

            ctx.fillStyle = "#fff";
            ctx.strokeStyle = "#fff";
            ctx.lineWidth = 1;

            const t = timestamp / 1000; // convert ms to seconds

            spiders.forEach((spider) => spider.update(t));

            requestAnimationFrame(loop);
        }

        requestAnimationFrame(loop);
    </script>
</body>

</html>